<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Pro Logo Studio</title>
<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileColor" content="#12003b">
<meta name="theme-color" content="#12003b">

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Fabric.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
<!-- Scripts with defer to maintain order -->
<script src="https://unpkg.com/lucide@latest" defer></script>
<script src="app.js" defer></script>
<!-- Add this tiny script inside your <head> or at the bottom of <body> -->
<!-- It tells the browser to look for your new sw.js file -->

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then(reg => console.log('Service Worker Registered!'))
        .catch(err => console.log('Service Worker Failed', err));
    });
  }
</script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:wght@700&family=Roboto+Mono:wght@500&family=Bebas+Neue&family=Pacifico&display=swap" rel="stylesheet">

<style>
    :root { --bg-dark: #09090b; --bg-panel: #18181b; --accent: #6366f1; }
    body { background-color: var(--bg-dark); color: white; font-family: 'Inter', sans-serif; overflow: hidden; touch-action: none; }
    .scrolling-toolbar { -ms-overflow-style: none; scrollbar-width: none; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; }
    .scrolling-toolbar::-webkit-scrollbar { display: none; }
    #canvas-wrapper {
        background-image: linear-gradient(45deg, #1c1c1c 25%, transparent 25%), linear-gradient(-45deg, #1c1c1c 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #1c1c1c 75%), linear-gradient(-45deg, transparent 75%, #1c1c1c 75%);
        background-size: 20px 20px; display: flex; align-items: center; justify-content: center; overflow: hidden;
    }
    input[type=range] { -webkit-appearance: none; background: transparent; }
    input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: var(--accent); margin-top: -6px; }
    input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #3f3f46; border-radius: 2px; }
    .color-wrapper { position: relative; overflow: hidden; width: 32px; height: 32px; border-radius: 50%; border: 2px solid #3f3f46; }
    .color-input { position: absolute; left: -50%; top: -50%; width: 200%; height: 200%; opacity: 0; cursor: pointer; }
</style>

</head>
<body class="h-screen flex flex-col">
<header class="h-14 bg-zinc-900 border-b border-zinc-800 flex items-center justify-between px-4 z-10 shrink-0">
    <div class="flex items-center gap-2">
        <i data-lucide="layers" class="text-indigo-500 w-5 h-5"></i>
        <span class="font-bold text-sm tracking-wide">STUDIO</span>
    </div>
    <div class="flex gap-3">
         <button id="btn-clear" class="text-xs text-zinc-400 font-medium">Clear</button>
         <button id="btn-export" class="bg-indigo-600 px-4 py-1.5 rounded-full text-xs font-bold text-white flex items-center gap-1">
            Save <i data-lucide="download" class="w-3 h-3"></i>
        </button>
    </div>
</header>

<main id="canvas-wrapper" class="flex-1 relative w-full">
    <canvas id="c"></canvas>
</main>

<div id="context-bar" class="bg-zinc-900 border-t border-zinc-800 shrink-0 hidden transition-all duration-200">
    <div id="ctrl-text" class="hidden w-full flex-col p-4 gap-4">
        <div class="flex justify-between items-center">
            <span class="text-xs text-zinc-500 uppercase font-bold">Text Edit</span>
            <button onclick="editTextContent()" class="text-indigo-400 text-xs font-bold border border-indigo-400 px-3 py-1 rounded">Edit Content</button>
        </div>
        <div class="scrolling-toolbar flex gap-4 pb-2">
            <select id="font-family" class="bg-zinc-800 text-xs p-2 rounded w-32 outline-none text-white">
                <option value="Inter">Inter</option>
                <option value="Playfair Display">Playfair</option>
                <option value="Roboto Mono">Mono</option>
                <option value="Bebas Neue">Bebas</option>
                <option value="Pacifico">Script</option>
            </select>
            <label class="bg-zinc-800 px-3 py-1 rounded text-xs flex items-center gap-2 whitespace-nowrap">
                <i data-lucide="image" class="w-3 h-3"></i> Texture
                <input type="file" id="text-img-fill" accept="image/*" class="hidden">
            </label>
        </div>
    </div>

    <div id="ctrl-shape" class="hidden w-full flex-col p-4 gap-4">
        <div class="flex justify-between items-center mb-1">
            <span class="text-xs text-zinc-500 uppercase font-bold">Appearance</span>
        </div>
        <div class="flex items-center gap-6">
            <div class="flex flex-col gap-1 items-center">
                <span class="text-[10px] text-zinc-400">Fill</span>
                <div class="color-wrapper bg-white" id="fill-preview">
                    <input type="color" id="shape-fill" class="color-input">
                </div>
            </div>
            <div class="flex flex-col gap-1 items-center">
                <span class="text-[10px] text-zinc-400">Outline</span>
                <div class="color-wrapper bg-transparent border-white" id="stroke-preview">
                    <input type="color" id="shape-stroke" class="color-input">
                </div>
            </div>
            <div class="flex flex-col gap-1 items-center">
                <span class="text-[10px] text-zinc-400">Gradient</span>
                <button onclick="applyGradient()" class="w-8 h-8 rounded-full bg-gradient-to-b from-indigo-500 to-pink-500 border-2 border-zinc-700"></button>
            </div>
            <div class="flex flex-col gap-1 items-center">
                <span class="text-[10px] text-zinc-400">Img Mask</span>
                <label class="w-8 h-8 rounded-full bg-zinc-700 flex items-center justify-center border-2 border-zinc-600">
                    <i data-lucide="image" class="w-4 h-4"></i>
                    <input type="file" id="shape-img-fill" accept="image/*" class="hidden">
                </label>
            </div>
        </div>
        <div class="space-y-3 pt-2">
            <div class="flex items-center gap-3">
                <i data-lucide="minus-square" class="w-4 h-4 text-zinc-500"></i>
                <input type="range" id="stroke-width" min="0" max="20" value="0" class="flex-1">
            </div>
            <div class="flex items-center gap-3">
                <i data-lucide="sun" class="w-4 h-4 text-zinc-500"></i>
                <input type="range" id="opacity" min="0.1" max="1" step="0.1" value="1" class="flex-1">
            </div>
        </div>
    </div>
</div>

<footer class="bg-black pb-safe shrink-0 z-20 border-t border-zinc-800">
    <div class="scrolling-toolbar flex items-center px-2 h-16 gap-2">
        <button onclick="openModal('modal-icons')" class="flex flex-col items-center gap-1 min-w-[64px] text-zinc-400 active:text-white">
            <i data-lucide="shapes" class="w-5 h-5"></i>
            <span class="text-[10px]">Icons</span>
        </button>
        <button onclick="addText()" class="flex flex-col items-center gap-1 min-w-[64px] text-zinc-400 active:text-white">
            <i data-lucide="type" class="w-5 h-5"></i>
            <span class="text-[10px]">Text</span>
        </button>
        <label class="flex flex-col items-center gap-1 min-w-[64px] text-zinc-400 active:text-white relative">
            <i data-lucide="image-plus" class="w-5 h-5"></i>
            <span class="text-[10px]">Upload</span>
            <input type="file" id="upload-img" accept="image/*" class="hidden">
        </label>
        <button onclick="toggleBg()" class="flex flex-col items-center gap-1 min-w-[64px] text-zinc-400 active:text-white">
            <i data-lucide="palette" class="w-5 h-5"></i>
            <span class="text-[10px]">Backgrnd</span>
        </button>
        <div class="w-[1px] h-8 bg-zinc-800 mx-2"></div>
        <button onclick="bringForward()" class="flex flex-col items-center gap-1 min-w-[64px] text-zinc-400 active:text-white">
            <i data-lucide="arrow-up-circle" class="w-5 h-5"></i>
            <span class="text-[10px]">Up</span>
        </button>
        <button onclick="sendBack()" class="flex flex-col items-center gap-1 min-w-[64px] text-zinc-400 active:text-white">
            <i data-lucide="arrow-down-circle" class="w-5 h-5"></i>
            <span class="text-[10px]">Down</span>
        </button>
        <button onclick="deleteActive()" class="flex flex-col items-center gap-1 min-w-[64px] text-rose-400 active:text-rose-200">
            <i data-lucide="trash-2" class="w-5 h-5"></i>
            <span class="text-[10px]">Delete</span>
        </button>
    </div>
</footer>

<div id="modal-icons" class="fixed inset-0 bg-black/90 z-50 hidden flex flex-col">
    <div class="p-4 flex justify-between items-center border-b border-zinc-800">
        <h2 class="font-bold text-white text-sm">Icon Library</h2>
        <button onclick="closeModal('modal-icons')" class="p-2 bg-zinc-800 rounded-full"><i data-lucide="x" class="w-4 h-4"></i></button>
    </div>
    <div class="flex-1 overflow-y-auto p-4">
        <div class="grid grid-cols-4 gap-4" id="icon-grid"></div>
    </div>
</div>

<dialog id="text-dialog" class="bg-zinc-900 border border-zinc-700 rounded-xl p-6 backdrop:bg-black/80 w-3/4 max-w-sm">
    <h3 class="text-white mb-2 text-sm font-bold">Edit Text</h3>
    <input type="text" id="dialog-text-input" class="w-full bg-black border border-zinc-700 rounded p-3 text-white mb-4 outline-none">
    <div class="flex justify-end gap-2">
        <button onclick="closeTextDialog(false)" class="text-zinc-400 text-xs px-3 py-2">Cancel</button>
        <button onclick="closeTextDialog(true)" class="bg-indigo-600 text-white text-xs px-4 py-2 rounded">Update</button>
    </div>
</dialog>

<script>
    // --- 1. Canvas Core ---
    const container = document.getElementById('canvas-wrapper');
    const canvas = new fabric.Canvas('c', {
        backgroundColor: '#000000',
        preserveObjectStacking: true,
        selection: false,
    });

    function resizeCanvas() {
        const size = Math.min(container.clientWidth, container.clientHeight) * 0.95; 
        canvas.setWidth(size);
        canvas.setHeight(size);
        canvas.renderAll();
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // --- 2. Logic & Event Handling (Fabric Side) ---
    const contextBar = document.getElementById('context-bar');
    const ctrlText = document.getElementById('ctrl-text');
    const ctrlShape = document.getElementById('ctrl-shape');

    canvas.on('selection:created', updateUI);
    canvas.on('selection:updated', updateUI);
    canvas.on('selection:cleared', () => {
        contextBar.classList.add('hidden');
        ctrlText.classList.add('hidden');
        ctrlShape.classList.add('hidden');
    });

    function updateUI() {
        const obj = canvas.getActiveObject();
        if (!obj) return;
        contextBar.classList.remove('hidden');
        if (obj.type === 'i-text') {
            ctrlText.classList.replace('hidden', 'flex');
            ctrlShape.classList.add('hidden');
        } else {
            ctrlShape.classList.replace('hidden', 'flex');
            ctrlText.classList.add('hidden');
        }
    }

    function addText() {
        const t = new fabric.IText('BRAND', { left: 100, top: 100, fontFamily: 'Inter', fill: '#fff', fontSize: 50, fontWeight: 'bold' });
        canvas.add(t);
        canvas.setActiveObject(t);
    }

    function addShape(type) {
        let s;
        const props = { left: 100, top: 100, fill: '#fff', width: 100, height: 100 };
        if (type === 'circle') s = new fabric.Circle({ radius: 50, ...props });
        else if (type === 'triangle') s = new fabric.Triangle(props);
        else s = new fabric.Rect(props);
        canvas.add(s);
        canvas.setActiveObject(s);
        closeModal('modal-icons');
    }

    // Modal Helpers
    function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

    // Icon Grid Init
    const icons = ['circle', 'triangle', 'square', 'star', 'zap', 'heart', 'anchor', 'award'];
    const grid = document.getElementById('icon-grid');
    icons.forEach(name => {
        const b = document.createElement('button');
        b.className = 'aspect-square bg-zinc-800 rounded flex items-center justify-center';
        b.innerHTML = `<i data-lucide="${name}"></i>`;
        b.onclick = () => ['circle', 'triangle', 'square'].includes(name) ? addShape(name) : addText(); // Simplified
        grid.appendChild(b);
    });

    // Fabric Style Config
    fabric.Object.prototype.set({ transparentCorners: false, cornerColor: '#fff', cornerStrokeColor: '#6366f1', borderColor: '#6366f1', cornerSize: 12, cornerStyle: 'circle' });
</script>

</body>
</html>
